{"version":3,"sources":["app/js/i18next-config.js","app/js/index-auth.js","app/js/init.js","app/js/settings.js"],"names":["settings","require","i18n","jqueryI18next","Backend","default","lngDetector","cache","Url","Cookies","backOpts","service","projectId","apiKey","referenceLng","version","backend","init","currentUrl","laSessionCookie","i18nOpts","fallbackLng","zh","sendMissingTo","interpolation","escapeValue","formatSeparator","format","f","value","lng","toUpperCase","Date","moment","Intl","NumberFormat","whitelist","enabledLangs","load","debug","ns","defaultNS","saveMissing","saveMissingTo","keySeparator","nsSeparator","pluralSeparator","detectorOptions","order","lookupQuerystring","lookupCookie","lookupLocalStorage","cookieMinutes","caches","excludeCacheFor","document","location","host","cookieDomain","mainDomain","cacheOptions","enabled","prefix","expirationTime","versions","detection","sendMissing","missingKeyHandler","miss","key","defaultValue","console","log","on","services","languageDetector","cacheUserLanguage","use","err","t","error","language","$","localize","e","preventDefault","lang","data","changeLanguage","query","search","get","in30Minutes","set","expires","authCookieName","loginClass","logoutClass","isDevel","authCookie","removeClass","addClass","addEventListener","module","exports","mainLAUrl","baseFooterUrl","collectory","url","title","biocache","bie","bieDis","regions","lists","spatial","images","cas","otherLinks","icon"],"mappings":"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","file":"public/js/app.js","sourcesContent":["var settings = require('./settings');\nvar i18n = require('i18next');\nvar jqueryI18next = require('jquery-i18next');\n// var backend = require('i18next-xhr-backend');\nvar Backend = require('i18next-service-backend').default;\nvar lngDetector = require('i18next-browser-languagedetector');\nvar cache = require('i18next-localstorage-cache');\nvar Url = require('domurl');\nvar Cookies = require('js-cookie');\n\n// We use this backend as remote because subdomains.l-a.site should request to l-a.site domain\nconst backOpts = {\n  // service url to the backend service\n  // i.e. https://api.spacetranslate.com or https://api.locize.io\n  service: '$_LOCALES_URL',\n  projectId: '',\n  apiKey: '',\n  referenceLng: 'en',\n  version: 'locales'\n}\nconst backend = new Backend();\nbackend.init(null, backOpts);\n\nvar currentUrl  = new Url;\n\nconst laSessionCookie = 'la-lang-session';\n\nconst i18nOpts = {\n  backend: backOpts,\n  //  lng: 'es',\n  fallbackLng: {\n    zh: ['en'],\n    default: ['en']\n  },\n  sendMissingTo: 'fallback',\n  interpolation: {\n    escapeValue: false,\n    formatSeparator: ',',\n    format: function f(value, format, lng) {\n      // https://www.i18next.com/formatting.html\n      // console.log(`Value: ${value} with format: ${format} to lang: ${lng}`);\n      if (format === 'uppercase') return value.toUpperCase();\n      if (value instanceof Date) return moment(value).format(format);\n      if (format === 'number') return Intl.NumberFormat(lng).format(value);\n      return value;\n    }\n  },\n  whitelist: settings.enabledLangs,\n  load: 'languageOnly', // 'es' o 'en', previously: 'all', // es-ES -> es, en-US -> en\n  debug: true,\n  ns: 'common',\n  defaultNS: 'common',\n  saveMissing: true, // if true seems it's fails to getResourceBundle\n  saveMissingTo: 'en',\n  keySeparator: 'ß',\n  nsSeparator: 'ð',\n  pluralSeparator: 'đ'\n};\n\nconst detectorOptions = {\n  // order and from where user language should be detected\n  order: ['querystring', 'cookie', 'navigator', 'localStorage', 'htmlTag'],\n\n  // keys or params to lookup language from\n  lookupQuerystring: 'lang',\n  lookupCookie: 'i18next',\n  lookupLocalStorage: 'i18nextLng',\n  cookieMinutes: 525600, // a year\n  // cache user language on\n  caches: ['cookie'],\n  excludeCacheFor: ['cimode'] // languages to not persist (cookie, localStorage)\n};\n\nif (document.location.host !== 'localhost:3333') {\n  // We set the upper domain in production so all ALA modules get the same locale\n  detectorOptions.cookieDomain = settings.mainDomain;\n}\n\nconst cacheOptions = {\n  // turn on or off\n  enabled: false,\n  // prefix for stored languages\n  prefix: 'i18next_res_',\n  // expiration\n  expirationTime: 7 * 24 * 60 * 60 * 1000,\n  // language versions\n  versions: {}\n};\n\ni18nOpts.cache = cacheOptions;\ni18nOpts.detection = detectorOptions;\n\ni18nOpts.sendMissing = false;\ni18nOpts.missingKeyHandler = function miss(lng, ns, key, defaultValue) {\n  // call to some API here\n  console.log(`\"${key}\": \"${defaultValue}\"`);\n};\n\ni18n.on('languageChanged', function (lng) {\n  if (i18n.services.languageDetector) {\n    console.log(`On lang changed ${lng}`);\n    // Store in the cookie the selection\n    i18n.services.languageDetector.cacheUserLanguage(lng);\n  }\n});\n\ni18n.use(backend)\n    .use(lngDetector)\n    .use(cache)\n    .init(i18nOpts, (err, t) => {\n      // initialized and ready to\n      if (err) {\n        console.error(err);\n        return;\n      }\n      console.log(`Language initialized: ${i18n.language}`);\n      jqueryI18next.init(i18n, $);\n      $(\"body\").localize();\n\n      $('.locale-link').on('click', function(e) {\n        e.preventDefault();\n        const lang = $(this).data('locale');\n        console.log(`Lang clicked ${lang}`);\n\n        i18n.changeLanguage(lang);\n\n        // Change ?lang param and reload\n        currentUrl.query.lang = lang;\n        document.location.search = currentUrl.query;\n      });\n\n      if (typeof Cookies.get(laSessionCookie) === 'undefined' && typeof currentUrl.query.lang === 'undefined') {\n        // Workaround to set grails locale\n        // This will use to do a unique lang redirect (to force grails to set the lang for the session)\n        var in30Minutes = 1/48;\n        // grails default session lifetime is 30min\n        Cookies.set(laSessionCookie, '/', { expires: in30Minutes });\n        currentUrl.query.lang = i18n.language;\n        document.location.search = currentUrl.query;\n      }\n\n      // cookies eu consent\n      /* const cookiesOpt = {\n       *   cookieTitle: t('Uso de Cookies'),\n       *   cookieMessage: t('Utilizamos cookies para asegurar un mejor uso de nuestra web. Si continúas navegando, consideramos que aceptas su uso'),\n       *   showLink: false,\n       *   position: 'bottom',\n       *   linkText: 'Lee más',\n       *   linkRouteName: '/privacy',\n       *   acceptButtonText: t('Aceptar'),\n       *   html: false,\n       *   expirationInDays: 70,\n       *   forceShow: false\n       * };\n       */\n      // CookieConsent.init(cookiesOpt);\n    });\n","var Cookies = require('js-cookie');\nconst settings = require('./settings');\nconst authCookieName = 'ALA-Auth';\nconst loginClass = 'signedIn';\nconst logoutClass = 'signedOut';\n\nif (document.location.host === settings.mainDomain || document.location.host === 'localhost:3333') {\n  if (settings.isDevel) console.log(\"We are in the main url, let's see if we are authenticated\");\n  // As this page is plain html, we have to detect if with are authenticated via Cookies\n  let authCookie = Cookies.get(authCookieName);\n  var in30Minutes = 1/48;\n\n  if (typeof authCookie === 'undefined' && settings.isDevel) {\n    console.log(\"We set a test cookie if we are in development\");\n    Cookies.set(authCookieName, '/', { expires: in30Minutes });\n  }\n\n  if (typeof authCookie !== 'undefined') {\n    // https://github.com/AtlasOfLivingAustralia/ala-bootstrap3/blob/master/grails-app/taglib/au/org/ala/bootstrap3/HeaderFooterTagLib.groovy\n    if (settings.isDevel) console.log(\"Auth cookie present so logged in\");\n    $(\"#drawer-nav-menu\").removeClass(\"signedOut\").addClass(\"signedIn\");\n  } else {\n    if (settings.isDevel) console.log(\"No auth cookie not present so not-logged in\");\n    $(\"#drawer-nav-menu\").removeClass(\"signedIn\").addClass(\"signedOut\");\n  }\n}\nelse {\n  if (settings.isDevel) console.log(\"We aren't in the main url\");\n}\n","require('./settings.js').default;\nrequire('./index-auth.js');\nrequire('./i18next-config.js');\n\n// require('./stats.js');\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  console.log('LA skin initialized');\n});\n","module.exports = {\n  isDevel: true,\n  enabledLangs: ['en', 'es', 'zh'],\n  mainDomain: 'l-a.site', // used for cookies (without http/https)\n  mainLAUrl: 'https://l-a.site',\n  baseFooterUrl: 'https://l-a.site',\n  services: {\n    collectory: { url: 'https://collections.l-a.site', title: 'Collections' },\n    biocache: { url: 'https://biocache.l-a.site', title: 'Occurrence records' },\n    bie: { url: 'https://especies.gbif.es', title: 'Species' },\n    bieDis: { url: 'https://species.l-a.site', title: 'Species' },\n    regions: { url: 'https://regions.l-a.site', title: 'Regions' },\n    lists: { url: 'https://lists.l-a.site', title: 'Species List' },\n    spatial: { url: 'https://spatial.l-a.site', title: 'Spatial Portal' },\n    images: { url: 'https://images.l-a.site', title: 'Images Service' },\n    cas: { url: 'https://auth.l-a.site', title: 'CAS' }\n  },\n  otherLinks: [\n    { title: 'Datasets', url: 'https://collections.l-a.site/datasets' },\n    { title: 'Explore your area', url: 'http://biocache.l-a.site/explore/your-area/' },\n    { title: 'Datasets', url: 'https://collections.l-a.site/datasets' },\n    { title: 'twitter', url: '', icon: 'twitter' }\n  ]\n}\n"]}